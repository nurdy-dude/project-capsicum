# Nginx configuration for Project Capsicum frontend

server {
  # Listen on port 80 inside the container
  listen 80;

  # Set the root directory to where the React app's static files are
  root /usr/share/nginx/html;
  index index.html;

  # Rule for API proxying
  # Any request starting with /api/ will be forwarded to the backend service
  # The 'backend' name comes from the service name in docker-compose.yml
  location /api/ {
    proxy_pass http://backend:3000/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }

  # Rule for all other requests
  # This makes sure that if a user reloads the page on a deep link
  # (e.g., /garden/plant/123), Nginx serves the main index.html file,
  # and React Router handles the routing on the client side.
  location / {
    try_files $uri $uri/ /index.html;
  }
}